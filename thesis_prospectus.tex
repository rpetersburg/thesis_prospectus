\documentclass[11pt]{article}
\usepackage[margin=1.0in]{geometry}

\usepackage{amsmath}
\usepackage{wrapfig}
\usepackage{natbib}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{float}
\usepackage{multirow}
\usepackage{siunitx}
\usepackage{bm}
\usepackage{bbm}

\title{Novel Methods of Wavelength Calibration for Fiber-fed Radial Velocity Spectroscopy}

\author{Ryan Petersburg\\
Yale University Department of Physics\\
Advisor: Debra Fischer\\
\\
Thesis Prospectus}
\date{August 2018}

\begin{document}

\maketitle

\begin{abstract}

Measuring the radial velocity of a star to high precision hinges on the ability to accurately wavelength calibrate the stellar spectrum. In the advent of Earth-like exoplanet discovery around G \& K spectral-type stars, the upper limit for error in these calibrations is \SI{10}{\centi\meter\per\second}, an order of magnitude better than the previous generation of instruments. In this doctoral thesis prospectus, I provide three novel methods that I am investigating to achieve to goal: (1) an astrocomb, built from an electro-optic modulation comb and an aluminum nitride waveguide, that can calibrate stellar spectra from the ultraviolet to the mid-infrared, (2) quasi-chaotic optical fiber agitation that nearly eliminates the effects of modal noise, and (3) spectro-perfectionism, a spectral extraction algorithm that uses information from the entire 2D point spread function of the instrument. If ultimately successful, these contributions could prove revolutionary for the field of fiber-fed radial velocity spectroscopy.

\end{abstract}

\pagebreak

\section{Introduction}

The discovery of less massive and longer period planets using the stellar radial velocity (RV) method requires an unprecedented level of spectroscopic precision. The current goal of RV spectroscopy is \SI{10}{\centi\meter\per\second} precision, a factor of 10 better than the current state-of-the-art spectrographs, thereby allowing the discovery of Earth-like planets orbiting G and K stars in their respective habitable zones \citep{Fischer2016}. The next-generation of visible-band RV spectrographs---including the EXtreme PREcision Spectrograph (EXPRES) \citep{Jurgenson2016}, the instrument I am using to support my work---are utilizing precision engineering and extreme environmental stability to reach this goal.

Regardless of the steps taken to stabilize the spectrograph, RV precision is ultimately limited by the ability to accurately calibrate stellar spectra. The process for wavelength calibration is rather intuitive: compare the absorption lines of the RV-shifted stellar spectrum with a well-known, un-shifted spectrum. There are three distinct steps to optimally achieve this goal:
\begin{enumerate}
    \item purchase or develop a calibration light source that fills the bandpass of the spectrograph while maintaining a level of stability within the RV precision requirements,
    \item optically couple the light source to the spectrograph detector without degrading the signal or introducing time-dependent shifts to the spectrum, and
    \item code an extraction algorithm that maximizes signal-to-noise and resolution of the calibration spectrum without increasing systematic error.
\end{enumerate}

In this document, I propose novel methods that address each of these three steps. Thus, I organize my prospectus (and my eventual dissertation) into three major sections, each pertaining to my work with one of the above topics. Since these topics are so distinct, I provide background for them individually in each of their respoective sections, instead of trying to compact it all into the introduction. In Section \ref{sec:astrocomb}, I discuss my plans to develop a cheaper and more reliable wavelength calibration source by combining an electro-optic modulation comb with an aluminum nitride waveguide. In Section \ref{sec:modal_noise}, I present results from my previous work mitigating modal noise through optical fiber agitation and my plans to demonstrate how this work is improving EXPRES calibration. Finally, in Section \ref{sec:spec_perf}, I introduce spectro-perfectionism and my work to develop point-spread-function modelling software and a deconvolution algorithm that can significantly improve extracted wavelength calibration spectra.

\section{Aluminum Nitride Astrocomb \footnote{The work in this section was proposed to the NSF, NASA, and Keck Foundation, therefore much of the language here was drawn from those proposals.}}
\label{sec:astrocomb}

In order to extract stellar spectra, RV spectrographs use the spectra of well-characterized and stable light sources as a simultaneous reference on the spectrograph camera. Historically, thorium argon (Th-Ar) lamps and iodine reference cells have been used to calibrate RV spectrographs since their spectral properties are well understood and their bandwidth covers most of the visible spectrum. However, both of these light sources have inherent issues that limit RV measurements to approximately 1 m/s precision. Th-Ar emission lines are broad, saturated, and irregularly spaced, meaning some wavelength regions are less well calibrated than others. The iodine technique, which applies absorption wavelengths directly on the stellar spectrum, masks the subtle spectral line profile effects imprinted by stellar activity. Furthermore, iodine introduces complexity, such as parameter cross talk, to the forward modeling \citep{Spronck2015} and the cells themselves may not have long term mechanical stability \citep{Fischer2014a}.

More recently, RV spectrographs have employed frequency combs (FCs), synthesized spectra containing sharp peaks of intensity at equally spaced frequencies, with the intention of better stability and therefore precision in their wavelength calibration. Ideally, the lines of a FC are non-overlapping and located at precisely determined wavelengths with flat intensity, to avoid over- or under-saturating pixels on the spectrograph camera. The FC must also have the proper free spectral range (FSR, frequency separation of comb lines) across the entire bandwidth of the spectrograph optics so that the camera can resolve each peak (more than $\sim$\SI{10}{\giga\hertz}) and calibrate a sufficient number of stellar frequencies (less than $\sim$\SI{40}{\giga\hertz}). Also, the zero-point frequency offset ($f_0$) and FSR should not drift over both short (seconds) and long (months) time scales. Most FC devices have been developed for the near-infrared, due to the proliferation of telecom interest around \SI{1550}{\nano\meter}, and this has been sufficient for observing M dwarf exoplanets \citep{Fischer2016}. However, to address planetary system statistics for late F, G, and early K type stars, the wavelength range will need to stretch through the visible to better calibrate many more absorption lines. It is especially important to reach the Calcium H & K lines located below \SI{400}{\nano\meter} that contain chromospheric activity information which characterizes photospheric noise \citep{Isaacson2010, Lovis2011}.

A relatively cheap way to produce a broadband optical FC is using a tunable Fabry-Pérot (FP), a resonant cavity that employs feedback to correct for drifts in length. They do not offer an inherent $f_0$ calibration, however, and must be referenced against a separate stable source for bootstrapped calibration \citep{McCracken2014, Sturmer2017} meaning the system cannot be self-contained. Therefore, fixed-length FP etalons were developed to mitigate this issue. However, \citet{Reiners2014} and \citet{Wildi2012} have shown that the set distance between the two reflective surfaces still drifts unpredictably, especially over long time scales, thereby continuing to limit spectrograph precision to only ~1 m/s.

Menlo Systems has built perhaps the most advanced wavelength calibrator for visible RV spectroscopy, a laser FC that reaches $\sim$\SI{1}{\centi\meter\per\second} RV precision \citep{Probst2014}. This FC pulses a femtosecond mode-locked laser to produce high finesse lines and an extremely stable FSR. Unfortunately, these lines are too tightly spaced for RV spectrographs, therefore the system must use line-by-line spectral filtering with multiple tunable FP cavities to suppress most of the produced frequencies. There are consequently some critical limitations to this device: complexity, cost, and limited bandwidth. The Menlo FC requires a continuing service contract to properly maintain it and thus has not yet reach true ``turn-key'' status. Also, this technology costs approximately \$1,000,000---a prohibitive price point for smaller RV projects---and is extremely bulky, limiting its use to larger ground-based spectrographs. Furthermore, the system is still lower-limited to $\sim$\SI{450}{\nano\meter} thereby excluding the critical Calcium H \& K lines below \SI{400}{\nano\meter}.

Therefore, I am proposing to develop an affordable, compact, and direct-generation optical FC (or ``astrocomb'') that extends from the near-ultraviolet to the mid-infrared ($\sim$350–-\SI{2500}{\nano\meter}). This astrocomb will utilize two technologies that have been already been thoroughly developed:
\begin{enumerate}
    \item a near-infrared electro-optic modulation (EOM) FC, and
    \item an aluminum nitride (AlN) on-chip waveguide that uses nonlinear material properties to broaden the EOM FC.
\end{enumerate}
Upon completion, this technology will be able to calibrate a wide range of RV spectrographs to $10^{-11}$ precision (corresponding to \SI{1}{\centi\meter\per\second} RV on EXPRES for example) in the search for Earth-like exoplanets orbiting sun-like stars. Such a laser frequency comb has not yet been introduced to the RV community, therefore any contribution I can make towards its completion would be a significant part of my thesis. This section begins with brief descriptions of the current advancement of both the EOM comb and AlN waveguides (Section \ref{subsec:astrocomb_bkgd}), followed by my preliminary comb design and plans for testing (Section \ref{subsec:comb_design}).

\subsection{Background}
\label{subsec:astrocomb_bkgd}

\subsubsection{Electro-optic modulation frequency comb}

The foundation of my proposed astrocomb is built upon a self-referenced cascading EOM comb \citep{Cole2015, Beha2017, Carlson2017a}. The layout for this fully functional EOM system, as described by \citet{Cole2015}, is shown in Figure \ref{fig:cole_eom}(a). This device feeds a \SI{1550}{\nano\meter} continuous wave pump laser through a series of electro-optic waveguides with sinusoidally varying voltages (precisely controlled by a \SI{10}{\giga\hertz} electronic oscillator) that add time dependent amplitude- and phase-shifts to the incident light. These modulators thereby split the pump laser into equally spaced (\SI{10}{\giga\hertz}) frequency sidebands with a combined bandwidth of approximately \SI{4}{\nano\meter} (Figure \ref{fig:cole_eom}(b)). Then, the light is propagated through \SI{100}{\meter} of highly nonlinear fiber (HNLF), which broadens the spectral width to \SI{40}{\nano\meter} using self-phase modulation nonlinearity, and a FP filter cavity that suppresses high-offset electronic frequency noise (Figure \ref{fig:cole_eom}(c)). A dispersion controller flattens the spectrum line-by-line and passes the pulses through an electro-optic gate that uses pulse selection to optionally decrease the FSR by integer factors. Finally, the light is amplified with an erbium doped fiber amplifier (EDFA) to \SI{2}{\watt} average power and propagated through \SI{8}{\meter} of HNLF, further broadening the comb to span the entire infrared octave between 1070 and \SI{2140}{\nano\meter} (Figure \ref{fig:cole_eom}(d)).

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/cole_eom.png}
    \caption{(a) Diagram of a self-referenced, octave-spanning EOM comb. (b) Sidebands created by the cascading phase and intensity modulators, spanning \SI{4}{\nano\meter} bandwidth (\SI{530}{\giga\hertz}) with \SI{10}{\giga\hertz} spacing resulting in 53 optical comb modes. (c) Spectrum with \SI{40}{\nano\meter} bandwidth after HNLF self-phase modulation broadening. (d) Octave-spanning EOM comb spectrum from 1070-–\SI{2140}{\nano\meter}. Complete image taken from \citet{Cole2015}}
    \label{fig:cole_eom}
\end{figure}

NIST has shown that the $f_0$ of the EOM comb can be calibrated using $f$--$2f$ interferometry \citep{Beha2017}. Since the comb is octave-spanning, the \SI{2140}{\nano\meter} line is frequency doubled and beat against the \SI{1070}{\nano\meter} line. After this stabilization, the EOM comb was shown to have a fractional uncertainty of $3 \times 10^{-13}$ at \SI{1}{\second} and $3 \times 10^{-14}$ at \SI{1000}{\second} corresponding to less than \SI{1}{\centi\meter\per\second} RV precision at both time scales \citep{Beha2017}. This technology is important to the astrocomb design because it was developed almost completely with commercial off-the-shelf products. Intensity and phase modulators, HNLFs, EDFAs, and FP filter cavities can be purchased relatively low-cost from many optics retailers. Also, microwave frequency electronic oscillators can be locked to GPS and have inherent stability much higher than required by an astrocomb, meaning the FSR would not need to be externally controlled. Therefore, this EOM design could be replicated with little modification on any optics table.

\subsubsection{Aluminum Nitride waveguide}

Optical nonlinearity is a strong tool that can be used on this near-infrared EOM comb to expand it into the visible spectrum. Second-order nonlinearities provide second harmonic generation (SHG), a specific form of sum frequency generation (SFG), that doubles the frequency of light incident on the nonlinear material (Figure \ref{fig:sfg_example}(b)). Similarly, third-order nonlinearities provide third harmonic generation (THG) that triples the incident light frequency (Figure \ref{fig:sfg_example}(c)). Silicon dioxide and silicon nitride (SiN), historically the most widely researched nonlinear waveguide materials, only have strong third-order nonlinearity. Aluminum nitride (AlN), on the other hand, is quickly gaining ground as a phenomenal material for on-chip nonlinear optics applications because it has both strong third-order and second-order nonlinearity as well as low loss over an extremely wide bandwidth from the ultraviolet to the mid-infrared \citep{Jung2016}. Therefore, AlN is ideally suited for application to a broadband astrocomb.

\begin{figure}
    \centering
    \includegraphics[width=0.6\textwidth]{images/sfg_example.png}
    \caption{Diagram of nonlinear optical multi-harmonic generation demonstrated by an AlN on-chip microring resonator. (a) Cascaded four-wave mixing NIR comb produced by the whispering gallery modes (unrelated to the proposed astrocomb) centered at 1550 nm. (b) Second order nonlinear effects produce a comb centered at 725 nm. (c) Third order nonlinear effects produce a comb centered at 517 nm. Complete image taken from \cite{Jung2014a}}
    \label{fig:sfg_example}
\end{figure}

The Yale Nanodevices Laboratory (YNDL) has developed a mature nanofabrication process for AlN that deposits the material with a predetermined geometry onto silicon nitride chips. Using this device, the YNDL has fabricated many on-chip AlN waveguides with varying lengths (\SI{300}{\micro\meter} to \SI{3}{\centi\meter} \citep{Xiong2012a}), thicknesses (330--\SI{1500}{\nano\meter} \citep{Pernice2012}), and shapes (e.g. differing radii of curvature). These tests also showed strong SHG in the AlN waveguides with differing wavelength-dependent throughput based on the associated geometries. More recently, the YNDL has explored more deeply into AlN microring resonators \citep{Jung2013, Guo2016}. For example, \citep{Jung2014a} demonstrated an AlN microring resonator that generated a green, red, and infrared FC using the Yale Exoplanet Laboratory (YEL) in-lab high-resolution spectrograph. The span of this comb is detailed in Figure \ref{fig:sfg_example}. Although the microresonator FC is not stabilized as of yet, it proves that sufficient power could be produced by the SHG and THG frequencies in AlN for detection by a RV spectrograph (with future research looking to stretch this to fourth harmonic generation).

I have also tested a more updated version of this microring resonator with EXPRES both when it was being commissioned in the Yale Exoplanet Lab and at the Discovery Channel Telescope. An example of one of the spectra taken is shown in Figure \ref{fig:aln_spectrum}. SHG lines are suppressed by an \SI{700}{\nano\meter} edgepass filter. However, there are clearly THG lines near \SI{500}{\nano\meter} and even a significant number of lines below the \SI{450}{\nano\meter} boundary that many other nonlinear optical materials (such as silicon dioxide and nitride) cannot seem to cross. These results are extremely promising for AlN's use as a SFG waveguide.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/aln_spectrum.png}
    \caption{Spectrum of an AlN microring measured with EXPRES.}
    \label{fig:aln_spectrum}
\end{figure}

AlN is also an excellent candidate for supercontinuum (SC) generation, the phenomenon where an incident narrow-band laser pulse experiences extreme spectral broadening when propagated through a nonlinear optical material \citep{Dudley2006}. The Menlo LFC actually uses SC generation, through a photonic crystal fiber (PCF), to produce its visible-spanning FC \citep{Probst2014}. However, the EXPRES group has found that this comb does not stretch below \SI{480}{\nano\meter} very reliably, with stated issues of PCF burning for blue and ultraviolet light. The YNDL, on the other hand, has shown promising preliminary results where a SC generated with an AlN waveguide and an \SI{80}{\mega\hertz} pulse laser produces blue and ultraviolet lines below \SI{450}{\nano\meter}. Although I cannot show these results here, they indicate that AlN is extremely well-suited for astrocomb application.

\subsection{Astrocomb Design and Testing}
\label{subsec:comb_design}

For my thesis, I am interested in recreating the EOM comb shown in Figure \ref{fig:cole_eom} while replacing both stages of broadening, the filter cavity, and dispersion controller with an AlN waveguide. Therefore, I would essentially like to design a \SI{16}{\giga\hertz} infrared EOM comb (effecitvely a \SI{16}{\giga\hertz} pulse laser) that is subsequently broadened from the ultraviolet to the mid-infrared by SC generation in the AlN. Unlike the Menlo mode-locked laser comb that suppresses lines in its over-dense fundamental spectrum, this astrocomb will produce each line directly with minimal active filtering allowing for a plug-and-play approach to RV spectrograph calibration.

I have already begun this process by order and receiving all of the parts for a \SI{16}{\giga\hertz} EOM comb. I am using an ultra-low noise semiconductor \SI{1550}{\nano\meter} laser (prototype from Thorlabs) as the continuous wave pump laser. This is fed into a series of phases modulator and a single intensity modulator from EOSpace. The voltages of these modulators are driven by a Signal Core tunable microwave oscillator that I will set to \SI{16}{\giga\hertz} (optimized for line spacing on EXPRES). Once I assemble these parts, I will test the output comb using analytic tools provided by the YNDL.

The next stage of my work will be combining this EOM comb with an AlN waveguide. I already have the necessary waveguide alignment equipment (digitally controllable piezo stages and a microscope), from my work imaging spectra from the AlN microring, making this process relatively simple. At this stage, I am hoping this \SI{16}{\giga\hertz} EOM comb recreates the visible SC produced by the YNDL \SI{80}{\mega\hertz} pulse laser. I will also be able to analyze this spectrum to much higher resolution than possible in the YNDL using the Yale Doppler Diagnostic Facility, a resolution 50,000 spectrograph, and EXPRES. These tests should give an early indication whether this project will be viable for astrocomb application.

Through this work, I am hoping to eliminate the dispersion controller and filter cavities from the previous design by \citet{Cole2015} (Figure \ref{fig:cole_eom}). These devices require separate active monitoring adding undue complexity to the completed astrocomb. AlN has already shown a relatively flat ($\sim$\SI{20}{\decibel} variance) SC response with the \SI{80}{\mega\hertz} pulse laser; therefore, with minimal dispersion engineering to reduce the variance to below \SI{10}{\decibel}, the spatial light modulator should not be necessary. The filter cavity, which was originally included to reduce thermal noise \citep{Carlson2017a}, can also be removed since I am using an ultra-low noise pump laser. If I am able to show that these two devices are not necessary, then this new AlN astrocomb could be revolutionary.

If time permits, I would also like to explore using feedback controls to stabilize the astrocomb. Since the AlN SC should span greater than one octave, self-referencing through $f$--$2f$ analysis would be possible. By feeding this information back to the pump frequency (controlled by the laser temperature) and feeding a GPS signal back to the FSR (controlled by the tunable microwave oscillator), the comb should be precise to the $10^{-11}$ level required by RV spectrographs. Once a stabilized comb is produced, I could take it to EXPRES and compare it directly against the Menlo LFC in terms of stability and reliability. Unfortunately, the prospects of actually reaching this point before I graduate is slim. Building a brand new astrocomb from scratch is a multi-year project, but I would be extremely happy to contribute as much as I can for my thesis, and if all goes well, I may be able to finish most of this work myself.


\section{Modal Noise Mitigation \footnote{I have already written a paper on most of this topic, therefore much of the language from this section is taken from \citet{Petersburg2018}}}
\label{sec:modal_noise}

Fiber coupling the spectrograph to the telescope has become an essential and standard method for planet hunting spectrographs. Separating the spectrograph from the telescope by a fiber tens of meters long enables the spectrograph to be located in a controlled environment, isolating it from vibrational and thermal noise. Linking the telescope to the spectrograph via fiber also leverages the spatial scrambling properties inherent to fibers that, for the most part, decouple input variations from the output producing a stable illumination of the spectrograph optics \citep{Hunter1992}. This effect has been amplified through the use of double scramblers \citep{Halverson2015a, Spronck2015} and non-circular fiber geometries \citep{Chazelas2010, Spronck2012, Plavchan2013}.

Optical fibers also transmit light from calibration sources, such as wavelength calibrators and broadband flat-field sources, to the spectrograph. Laser frequency combs, especially the  astrocomb \citep{Probst2014} recently deployed at HARPS and soon at EXPRES, produce thousands of ultra-narrow, evenly spaced emission lines over a wide frequency range. When these highly coherent lines propagate through a multi-mode fiber, they create a source of noise that limits the signal-to-noise ratio (S/N) of the instrument and potentially induces false RV signals in the data. This noise is caused by interference between the finite number of electromagnetic modes that can propagate along a multi-mode fiber, and therefore the term \textit{modal noise} has been coined for this effect \citep{Epworth1978}.

For this part of my thesis, I have discerned an optimal strategy for mitigating modal noise using mechanical agitation on multi-mode fibers propagating coherent visible light. I also expect to show that introducing a quasi-chaotic agitator to EXPRES has significantly reduced potential RV errors. This section begins with a definition of modal noise and an exploration for how previous experiments have mitigated it through static and dynamic methods (Section \ref{subsec:modal_noise_intro}). I then describe a novel form of quasi-chaotic coupled agitation and discuss results that show improvement in S/N and RV precision (Section \ref{subsec:modal_noise_results}). Finally, I describe my efforts to build an optimal agitator for EXPRES and propose an experiment to approximate the improvements it makes to EXPRES calibration spectra (Section \ref{subsec:modal_noise_testing}).

\subsection{Background}
\label{subsec:modal_noise_intro}

Light propagates through an optical fiber in an integer number of electromagnetic modes. The exact calculation for this value is nontrivial since it depends on the instantaneous fiber geometry, injection parameters, and many other variables. The maximum number of modes for a step-index circular cross-section fiber (propagating a relatively large number of modes) with a monochromatic light source is approximately
\begin{equation}
M_{circ} \approx \frac{4}{\pi ^2} V^2 = \frac{4}{\pi ^2} \Bigg( \frac{2 \pi r \mathrm{NA}}{\lambda} \Bigg) ^2.
\label{eq:max_modes}
\end{equation}
$V$ is the normalized frequency of the fiber rewritten in terms of $\mathrm{NA} = \sqrt{n_\mathrm{core}^2 - n_\mathrm{clad}^2}$, the numerical aperture of the fiber determined by the core ($n_\mathrm{core}$) and cladding ($n_\mathrm{clad}$) indices of refraction, the core radius $r$, and the wavelength $\lambda$ of propagated light. This approximation is more difficult for a rectangular fiber, but \citet{Nikitin2011} shows empirically using electromagnetic and geometrical arguments that
\begin{equation}
\frac{M_\mathrm{rect}}{M_\mathrm{circ}} \approx 2 \frac{ab}{\pi r^2}
\label{eq:prop_modes}
\end{equation}
where $a$ and $b$ are the side lengths of the rectangular cross-section. Notice that $ab$ and $\pi r^2$ give the areas for a rectangle and circle respectively. From this, I assert more generally, with some rearrangement of Eq. (\ref{eq:max_modes}), that
\begin{equation}
M_{s} \approx \frac{16}{\pi} C_{s} A \Bigg( \frac{\mathrm{NA}}{\lambda} \Bigg) ^2
\label{eq:mode_area}
\end{equation}
where $A$ is the cross-sectional area of the fiber and $C_{s}$ is a constant coefficient dependent on fiber cross-sectional shape such that $C_\mathrm{circ} = 1$ and $C_\mathrm{rect} = 2$. $C_{s}$ is so far unknown for more complicated geometries, but I assume that $C_{s} \sim 1$.

\begin{figure}
    \begin{center}
	    \includegraphics[width=0.5\textwidth]{images/fiber_example.pdf}
	\end{center}
	\caption{Examples of unmitigated modal noise for a \SI{200}{\micro\meter} circular (left), \SI{200}{\micro\meter} octagonal (middle), and \SI{100x300}{\micro\meter} rectangular (right) optical fiber. All three fibers shown here have approximately the same cross-sectional area, meaning that they each are propagating about the same number of electromagnetic modes (see Eq. (\ref{eq:mode_area})). Brightness in this image is scaled by (photon count)$^{0.6}$ for better presentation of the range of speckle brightness. The contrast of the speckles is therefore \textit{worse} than what is shown here.}
\label{fig:fiber_example}
\end{figure}

When coherent light is propagated through a multi-mode fiber, a high contrast speckle pattern known as modal noise is produced at the output for both the near field (fiber face projected onto a detector, Figure \ref{fig:fiber_example}) and far field. Modal noise is an inherent property of all multi-mode fibers regardless of the cross-sectional core shape \citep{Sablowski2016}. It arises from light coupling from mode-to-mode as it propagates through the fiber, causing slight variances in the path length traveled and producing the observed interference pattern. For RV spectrographs, this causes two problems: (1) it limits the maximum S/N and (2) systematic variations in the speckle pattern will mask themselves as minute shifts on the focal plane causing errant RV signatures.

\subsubsection{Limit on S/N}

Due to its high contrast, modal noise can severely decrease the S/N of an RV spectrograph \citep{Epworth1978, Baudrand2001, Lemke2011, Iuzzolino2014}. For a fiber without spatial filtering or a slit, the magnitude of this noise is proportional to $\sqrt{M_s}$ \citep{Goodman1981}. Therefore, increasing the size of the fiber, increasing the numerical aperture of the fiber (or decreasing the injected focal ratio), and decreasing the wavelength of injected light should increase the S/N due to modal noise. It also appears that changing the fiber core shape could affect the S/N.

Experimental results of these conditions have been well documented. S/N due to modal noise has been shown empirically to
\begin{enumerate}
\item increase with larger fiber core cross-sectional area \citep{Lemke2010, Sablowski2016},
\item decrease with larger focal ratios \citep{Baudrand2001, Sablowski2016},
\item decrease with longer wavelength of injected light \citep{Baudrand2001},
\item slightly increase with more static bends in the fiber (changing the NA) \citep{Imai1979},
\item remain the same for differing fiber lengths greater than a few meters \citep{Baudrand2001}, and
\item improve for non-circular fibers over circular fibers \citep{Sablowski2016, Sturmer2016}.
\end{enumerate}
All of these results follow exactly from Eq. (\ref{eq:mode_area}) and implies that fibers with non-circular geometries have larger $C_{s}$.

\subsubsection{Systematic variations}
\label{subsec:sys_var}

Since the resultant speckle pattern is dependent on dynamic optical properties of the fiber, modal noise can induce false RV's on the spectrograph \citep{Mahadevan2014}. The spectrograph input is directly imaged onto the detector, so any spatial variation in intensity of the injected light will change the apparent line spread function in the spectra and cause errors in the assigned RVs. If these drifts have some regular period, modal noise could even cause errant planet signatures.

As is clear in Eq. (\ref{eq:mode_area}), modal noise is heavily wavelength dependent. When the center wavelength of a coherent light source changes, the speckle pattern subsequently shifts.  Speckle patterns can be visually distinguished when the injected wavelength of light changes by at least \SI{8}{\pico\meter} at \SI{1500}{\nano\meter} \citep{Redding2013}. Next-generation RV spectrographs are using laser frequency combs with $10^{-11}$ stability \citep{Probst2014}, or less than $10^{-4}$ \SI{}{\pico\meter} stability at \SI{1500}{\nano\meter}, rendering speckle drift due to wavelength drift effectively irrelevant. However, since the speckle pattern is smoothly wavelength dependent, the resultant spectral line spread function of a frequency comb is correlated between neighboring lines, meaning any drift due to modal noise is not necessarily randomly distributed across the spectrum.

The speckle pattern seen at the end of a fiber changes over time most commonly because of \citep{Epworth1978}:
\begin{enumerate}
\item temperature variation,
\item fiber input illumination variation, and
\item fiber movement (bending, twisting, etc.).
\end{enumerate}
These three conditions inevitably pose problems when imaging a spectrum since they are inherent to modern fiber-fed RV spectrographs \citep{Baudrand2001, Mahadevan2014}. There is typically a changing temperature differential between the telescope and the spectrograph, fluctuations in atmospheric density and guiding change the fiber illumination, and the telescope (along with the connected fibers) slowly moves throughout the night.

The resultant RV precision ($\sigma_{RV}$) due to a shifting speckle pattern centroid at the end of a fiber is calculated as
\begin{equation}
\sigma_{RV} \approx \frac{c}{R} \frac{\sigma_d}{D},
\label{eq:rv_error}
\end{equation}
where $c$ is the speed of light in a vacuum, $R$ is the resolution of the spectrograph, $\sigma_d$ is the standard deviation of fiber near-field centroid drift in the dispersion direction, and $D$ is the slit width (or short-end length of a rectangular fiber). Please see \citet{Petersburg2018} for a full derviation. Notice that for a $R=150,000$ spectrograph fed by a \SI{33}{\micro\meter} slit attempting to reach \SI{1.0}{\meter\per\second} RV precision per line, the required stability of the centroid along the dispersion direction is \SI{0.0165}{\micro\meter}.

Importantly, $\sigma_{RV}$ is only the RV error \textit{per resolution element} or \textit{per line} from a wavelength calibration source. Averaging over $N$ lines with independent modal structure, we can divide $\sigma_{RV}$ by $\sqrt{N}$ to approximate total RV error. $N$ may not necessarily equal the total number calibration lines, however, since two neighboring wavelengths may propagate with the same number of modes and thus the same modal structure. Recall from Eq. (\ref{eq:mode_area}) that the number of supported modes is a function of wavelength. With a high number (thousands) of propagating modes, we do not expect adding or subtracting a single mode will result in a statistically independent modal noise structure.

However, assuming a difference in 10 supported modes makes the structure effectively independent, I assert
\begin{equation}
N \approx \frac{M_s(\lambda_{min}) - M_s(\lambda_{max})}{10},
\label{eq:N}
\end{equation}
where $\lambda_{min}$ and $\lambda_{max}$ are, respectively, the minimum and maximum wavelengths of the relevant calibration region. Note that the calibration source needs to be sufficiently dense (i.e. the number of lines is greater than $N$) to properly use this approximation. Even though Eq. (\ref{eq:N}) has not been empirically tested, since it requires a comprehensive study on the systematic correlation of modal noise, I believe it to be a rather conservative estimate for statistical reduction.

\subsubsection{Mitigation Techniques}
\label{subsec:mitigation}

\begin{table*}
\centering
\small
\caption{Previous Study of Dynamic Modal Noise Mitigation Methods}
	\small
	\begin{tabular}{llcc}
		\hline
		References & Method & Frequency & Amplitude \\
		\hline\hline
		\citet{Daino1980} & Loudspeaker & \SI{110}{\hertz} & ``Sufficient'' \\
		\hline
		\citet{Hill1980} & Turbulent Air Stream & ---- & --- \\
		\hline
		\citet{Baudrand2001} & --- & \SI{30}{\hertz} & \SI{1}{\milli\meter} \\
		\hline
		\multirow{2}{*}{\citet{Lemke2011}} & Loudspeaker & 1.5 Hz & --- \\
		 & Loudspeaker & \SI{80}{\hertz} & --- \\
		\hline
		\multirow{3}{*}{\citet{McCoy2012}} & Paint mixer & \SI{60}{\hertz} & --- \\
		 & Hand agitated & 1-\SI{2}{\hertz} & 10-\SI{15}{\centi\meter} \\
		 & Mechanical agitator & 2-\SI{3}{\hertz} & 1-\SI{5}{\centi\meter} \\
		\hline
		\multirow{2}{*}{\citet{Plavchan2013}} & ``Tweeter'' & \SI{100}{\hertz} & \SI{1}{\milli\meter} \\
		 & ``Woofer'' & \SI{1}{\hertz} & \SI{25}{\milli\meter} \\
		\hline
		\multirow{3}{*}{\citet{Mahadevan2014}} & Int. Sph. + Diff. & --- & ---\\
		 & McCoy agitator & 2-\SI{3}{\hertz} & 1-\SI{5}{\centi\meter} \\
		 & Hand agitation & 1-\SI{2}{\hertz} & \SI{10}{\centi\meter} \\
		\hline
		\multirow{2}{*}{\citet{Halverson2014}} & Int. Sph. + Diff. & --- & --- \\
		 & Int. Sph. + Rot. Mirror & --- & --- \\
		\hline		
		\citet{Roy2014} & Rail agitator & 1-\SI{2}{\hertz} & \SI{170}{\milli\meter} \\
		\hline
		\citet{Sablowski2016} & ``Rotating Excenter'' & \SI{2}{\hertz} & \SI{20}{\centi\meter} \\
		\hline
	\end{tabular}
\label{table:previous_studies}
\end{table*}

Modal noise can be mitigated by continuously exacerbating one of the above three dynamic variations, thereby shifting the speckle pattern throughout an appropriately long camera exposure and averaging out the noise. Controlled temperature variation (option 1) is non-ideal because a \SI{1}{\meter} fiber requires approximately $8 ^\circ \mathrm{C}$ amplitude fluctuations to visibly decorrelate the speckle pattern \citep{Redding2013}, and would be impractical to implement. Therefore, RV spectrographs have been left with either varying the illumination (option 2) or shaking the fiber (option 3). As summarized in Table \ref{table:previous_studies}, these modal noise reduction techniques have been discussed by many experiments concerned with RV spectroscopy.

\citet{Mahadevan2014} and \citet{Halverson2014} explore the effectiveness of varying the illumination on the fiber face. Using an integrating sphere, diffuser, and rotating mirror, they show gradual improvements in modal noise reduction due to the addition of further illumination variation. However, the integrating sphere, an integral part of these methods, has a throughput efficiency of approximately $10^{-6}$ and is not feasible to be introduced in the science light optical path. To allow flexible observing programs, particularly science observations bracketed by precision wavelength calibration sources, the modal noise mitigation technique needs to be more efficient.

Otherwise, the majority of these studies use various forms of agitation---including loudspeakers, paint mixers, and air streams---that shake the fiber over time. The variation in frequency and amplitude for these methods is unfortunately quite wide and conclusions are difficult to make. However, there have been slight trends in the results and the discussed assumptions so far are as follows:
\begin{enumerate}
\item The frequency of agitation should be greater than $1/\tau$, where $\tau$ is the exposure time \citep{Baudrand2001}.
\item Noise is more effectively reduced by high-amplitude motion \citep{Lemke2011, McCoy2012}.
\item More oscillations per exposure time (with an upper limit) provide further noise reduction \citep{Lemke2011}.
\item Combining a high-frequency ``tweeter'' with a high-amplitude ``woofer'' reduces noise effectively \citep{Plavchan2013}.
\item Hand agitation is better than any form of mechanical agitation \citep{Lemke2011, McCoy2012, Mahadevan2014, Roy2014}.
\item Non-harmonic or chaotic motion is recommended \citep{Grupp2003} though an exact method has not yet been experimentally tested.
\end{enumerate}
Although this has been good for subjective intuition, the exact mechanisms behind the improvements in S/N and prevention of RV drift due to fiber agitation have not yet been explored.

\subsection{Results from in-lab testing}
\label{subsec:modal_noise_results}

I have actually already completed all of the work to fill out the parameter space of fiber agitation methods further than previous studies. I was able to find trends across different agitation amplitudes and frequencies, fiber shapes and sizes, and coupling permutations to make more precise conclusions about the nature of modal noise mitigation through fiber agitation. A full description of the experiment and my results can be found in my paper on the subject \citep{Petersburg2018} and will be included in my dissertation. For brevity, the following are the general conclusions that I was able to draw from these results:
\begin{enumerate}
\item Agitating the fiber with the \textbf{most modes}, regardless of its placement in the fiber architecture, yields the best S/N. This typically means the fiber with the largest core size and lowest azimuthal symmetry.
\item \textbf{Large-amplitude} agitation is much more important than high-frequency agitation as long as the agitation method reaches at least one full rotation within an exposure. Adding a ``tweeter'' shows minimal improvement over large-amplitude motion alone.
\item \textbf{Chaotic agitation}, such as the motion created by our ``coupled'' agitator, is much more effective at mitigating modal noise than typical harmonic agitation and continues to improve S/N over multiple rotations. The frequency of this method should place the fiber into as many configurations as possible over a single exposure without over-stressing the fiber.
\item \textbf{Agitating more fibers} in a fiber architecture, especially when the fibers have different geometry (size/shape), will help increase S/N. Using a single agitator with one fiber looped over it several times, however, helps only slightly. Rather, adding a second independent agitator (i.e. chaotic agitation) increases S/N significantly more.
\end{enumerate}

\begin{figure}
\centering
	\includegraphics[width=\textwidth]{images/rv_error.pdf}
	\caption{Centroid drift and resultant RV error for a fiber moved by a simulated telescope (first), slowly agitated fiber (second), coupled agitated fiber (third), and LED illumination (fourth). Each line represents a different exposure time each with their own calculated RV error. Note that the scale for the top three plots are different.}
\label{fig:rv_error}
\end{figure}

I also include my results from the paper that directly relate the effects of modal noise to potential RV errors in a spectrograph. To observe how the centroid of modal noise actually drifts over time, I tested a quasi-chaotic agitation method on the \SI{100x300}{\micro\meter} rectangular fiber over three hundred \SI{1.0}{\second} exposures. This agitation method I used to test RV precision includes a circular agitator oscillating at \SI{1.1}{\hertz} and a linear agitator set at \SI{240}{\milli\meter} and \SI{1.0}{\hertz}. Keeping the two agitators at slightly different frequencies means that phase between them constantly changes and a large range of fiber configurations are reached after about \SI{10}{\second}.

I compared this idealized method to an LED source (low modal noise), a slowly agitated fiber (high modal noise), and a fiber moved as if it were attached to a telescope (very high modal noise). For the slow agitation test, I set only the linear agitator at \SI{80}{\milli\meter} and \SI{0.03}{\hertz} meant to simulate a worst-case simple harmonic agitation method. To simulate the telescope motions, I used the linear agitator with \SI{80}{\milli\meter} amplitude but did not rotate continuously. Rather, I left the agitator off most of the time except to turn it on briefly (about a quarter or half rotation) every 50 images. This approximates two conditions of the telescope: nearly still while tracking a star and sudden motion while switching targets.

To calculate the RV error, I first found the centroid within the fiber face for each image, relative to the center of the fiber in order to remove the observable ($\sim 2$ pixel) drift of the fiber stage. I then projected this centroid drift along the short axis of the rectangle. I also averaged these centroids over sets of 10 and 30 images to approximate the centroid drift for longer exposure times. For each length of exposure, I calculated the standard deviation of the centroid drift and converted all values to RV using Eq. (\ref{eq:rv_error}). The dispersion direction for a rectangular fiber is along the short end, meaning that the slit width $D$ is \SI{100}{\micro\meter}. The resolution of EXPRES is 150,000 for a \SI{33x132}{\micro\meter} rectangular fiber, so we use $R=50,000$ in Eq. (\ref{eq:rv_error}) since our test fiber is three times as wide as the EXPRES fiber in the dispersion direction.

The results, shown in Figure \ref{fig:rv_error}, indicate that continuous agitation is essential to control modal noise. The simulated telescope yields RV errors above \SI{20}{\meter\per\second} that do not average out well with longer exposures. Using the idealized method of coupled agitation reduces errors from slow agitation by about 5--8 times and are so far minimized to about \SI{60}{\centi\meter\per\second} when using \SI{30}{\second} exposures. The minimum RV error I could measure in this test, by using the LED source, was \SI{26}{\centi\meter\per\second}. Therefore, the coupled agitation method is less than a factor of 3 from reaching the noise floor.

The calculated \SI{60}{\centi\meter\per\second} error for coupled agitation is the RV error \textit{per line} in the spectrograph. Thus, the total RV error could be reduced to below \SI{10}{\centi\meter\per\second} with only 36 mode-independent calibration lines. EXPRES is using a laser frequency comb with approximately {\SI{14}{\giga\hertz}} line spacing across 450-{\SI{700}{\nano\meter}} fed by a {\SI{33x132}{\micro\meter}} rectangular fiber at $f/3.0$ resulting in almost 17,000 calibration lines. Applying Eq. (\ref{eq:N}), EXPRES will have $N=350$, reducing the expected RV error of the instrument to less than {\SI{3.2}{\centi\meter\per\second}}.

\subsection{EXPRES agitator and proposed testing}
\label{subsec:modal_noise_testing}

\begin{figure}
    \centering
    \includegraphics[width=0.75\textwidth]{images/agitator.jpg}
    \caption{Picture of the agitator installed with EXPRES at the Discovery Channel Telescope. The fiber is restrained by rubber bands in this image, but a recent update replaced those with longer-lasting springs.}
    \label{fig:agitator}
\end{figure}

These data were used to influence an agitator that I designed, built, and installed with EXPRES. As shown in Figure \ref{fig:agitator}, the agitator has two arms that each rotate independently using separate voltage-controlled DC motors. I have set these arms to rotate at \SI{0.45}{\hertz} and \SI{0.5}{\hertz} for every exposure, including wavelength calibration, flat-fielding, and stellar observations. These frequencies were chosen to maximally change the phase between the two arms within every exposure without over-stressing the fibers. That being said, the agitator has been in use since the beginning of 2018 and there has yet to be any sign of fiber degradation caused by agitation.

Now that this fiber agitator is installed on an active spectrograph, I would like to study the effects and mitigation of modal noise on a series of wavelength calibration spectra as the final step in this section of my thesis. There are two fundamental questions I would like to answer:
\begin{enumerate}
    \item To what extent does fiber agitation improve errors to the wavelength solution caused by modal noise and does this improvement follow the same trend as seen in the above results?
    \item Does modal noise introduce correlated errors in the spectrograph wavelength solution or is it effectively random?
\end{enumerate}
The data for this experiment will be EXPRES wavelength calibration spectra (Th-Ar and Menlo LFC) with the agitator turned on and off. I will also vary the length of exposures (after changing the intensity of each light source using neutral density) for both of these cases in a similar way to the above experiments. By comparing the wavelength solutions extracted from these sets of data, I will be able to answer the above questions respectively:
\begin{enumerate}
    \item If the scatter in residuals of the wavelength solution decreases with more agitation (i.e. longer exposure times), then there would be evidence that agitation is worthwhile for RV spectroscopy.
    \item Assuming errors when the agitator is turned on are randomly distributed, if there is a trend to the difference between the wavelength solutions when the fiber agitator is on or off (i.e. the difference in one line strongly predicts the difference in a neighboring line), then there is evidence that modal noise is correlated by wavelength.
\end{enumerate}
I expect to be able to complete these tasks with about a month of work, once the Menlo LFC comes back online and the EXPRES group develops a standardized method of calculating the wavelength solution.

\section{Spectro-perfectionism}
\label{sec:spec_perf}

With a high precision light source and a low noise optical coupling scheme, all that is necessary is a reliable way to convert the two-dimensional echellogram of the wavelength calibration source into a one-dimensional spectrum. This process is called \textit{extraction} and there are a myriad of methods that can accomplish this goal. Optimally, an extraction algorithm would maximize resolution and S/N of the data without altering the spatial positions of the calibration lines. This is because, after extraction, a wavelength calibration spectrum should yield a wavelength solution that accurately corresponds each pixel of a stellar spectrum to a wavelength, thereby enabling precise RV measurement.

Therefore, for the final part of my thesis, I am developing an extraction algorithm that uses the instrument's point spread function (PSF) to ``perfectly'' extract spectra. This algorithm, coined \textit{spectro-perfectionism} by \citet{Bolton2009}, is meant to compete with the current standard in RV data processing, \textit{optimal extraction} \citep{Horne1986}. In this section, I briefly describe the history of optimal extraction and spectroperfectionism (Section \ref{subsec:spec_perf_intro}). Then, I describe the need for accurate PSF modelling and detail my past efforts into doing so for EXPRES (Section \ref{subsec:psf}). Finally, I introduce my own version of the spectro-perfectionism alorithm, lay out some preliminary results using this data, and explain how I intend to compare my algorithm directly against optimal extraction (Section \ref{subsec:sp_tests}).

\subsection{Background \footnote{The introductory information in this section is primarily a distillation of the descriptions from \citet{Zechmeister2013} and \citet{Bolton2009}}}
\label{subsec:spec_perf_intro}

In principle, fiber-fed echelle spectrograph extraction is a discrete convolution problem. The bias, dark, and background subtracted CCD data ($D_{x,y}$) with pixel indices $(x, y)$ is a convolution of the spectral intensities ($s_\gamma$ at wavelength $\gamma$) and the instrument's wavelength-dependent PSF ($\Psi_{x,y,\gamma}$) with added noise ($n_{x,y}$):
\begin{equation}
    D_{x,y} = \sum_\gamma \Psi_{x,y,\gamma} s_\gamma + n_{x,y}.
\label{eq:convolution}
\end{equation}
With this in mind, and assuming that the noise if approximately gaussian, extraction is therefore ``simply'' a linear least-squares problem
\begin{equation}
    \chi^2 \approx \sum_{x,y} w_{x,y} \bigg[D_{x,y} - \sum_\gamma \Psi_{x,y,\gamma} s_\gamma \bigg]^2
    \label{eq:least_squares}
\end{equation}
where $\chi^2$ must be minimized. The weights $w_{x,y}$ are typically determined using a noise model $\sigma_{x,y}$ and a binary mask $M_{x,y}$ (removing bad pixels and pixels outside each echelle order) such that $w_{x,y}=\frac{M_{x,y}}{\sigma^2_{x,y}}$. In this section, I will be addressing two methods that can be used to solve Eq. \ref{eq:least_squares}: (1) optimal extraction and (2) spectro-perfectionism.

The current standard of fiber spectrograph extraction is the optimal technique, originally devised by \citet{Horne1986} but later refined in multiple papers, including (but not limited to) \citet{Piskunov2002} and \citet{Zechmeister2013}. This method makes the assumption that the PSF is a 1D slit function, thereby associating each column of an echelle order to a wavelength ($\gamma \rightarrow x$). Thus, the PSF can be rewritten in terms of a Kronecker delta
\begin{equation}
    \Psi_{x,y,\gamma} = \delta_{x,\gamma}\psi_{\gamma,y}
\label{eq:psf_optimal}
\end{equation}
and Eq. \ref{eq:convolution} simplifies to
\begin{equation}
    D_{x,y} = \psi_{x,y} s_x + n_{x,y}.
\end{equation}
Now, Eq. \ref{eq:least_squares} is solvable (setting $\frac{\partial}{\partial s_x} \chi^2 = 0$) for all $x$
\begin{equation}
    s_x = \frac{\sum_y w_{x,y} \psi_{x,y} D_{x,y}}{\sum_y w_{x,y} \psi^2_{x,y}}.
\end{equation}
The only thing remaining is to determine $\psi_{x,y}$. There are two possible approaches:
\begin{enumerate}
    \item make an initial guess (probably using $D_{x,y}$) and then iterate between extracting the spectrum and constructing a new $\psi_{x,y}$ based on the result \citep{Horne1986, Piskunov2002}, or
    \item use a low noise flat-field image $F_{x,y}$ that is taken by feeding a flat light source through the same path as the stellar spectrum. This image can be normalized (and possibly fit) to approximate $\psi_{x,y}$, or it can be used without normalization to produce a flat-normalized spectrum \citep{Zechmeister2013}.
\end{enumerate}

Although this method of optimal extraction has proven to be extremely prolific in the field of radial velocity echelle spectroscopy, it has a significant flaw: it does not take into account the full 2D PSF of the instrument. Thus, optimal extraction assumes that the spectrograph slit is uniformly aligned to the columns of the CCD and that the spectral information of a single wavelength bin is entirely contained in that column. However, the point spread function of echelle spectrographs typically envelope multiple columns of pixels (e.g. EXPRES was designed for a resolution element containing 4 columns) and slight alignment errors could add an angle to the slit function (not even taking into account the possibility of a varying slit function angle across the CCD).

Therefore, \citet{Bolton2009} rather found a solution to Eq. \ref{eq:least_squares} directly without any assumptions while using the entire 2D PSF. This solution in matrix notation is
\begin{equation}
    \textbf{s} = (\bm{\Psi}^T \bm{N}^{-1} \bm{\Psi})^{-1} \bm{\Psi}^T \bm{N}^{-1} \bm{D}
    \label{eq:bolton_solution}
\end{equation}
where $\bm{N}$ is the pixel noise matrix. Since pixel errors are typically treated as independent, $\bm{N}$ tends to be diagonal.

\citet{Bolton2009} have demonstrated that this technique yields better S/N than optimal extraction. However, they were only able to show this using simulated data that was, at most, $51\times101$ pixels in size. Therefore, I am interested in expanding their work through a few different avenues.
\begin{enumerate}
    \item Since the \citet{Bolton2009} data is purely simulated, they knew the exact PSF before executing the algorithm. I would need to measure the pixel-dependent PSF of EXPRES to even begin to use spectro-perfectionism.
    \item The EXPRES spectrograph CCD is $10k \times 10k$ pixels, much larger than the simulated data in \citet{Bolton2009}. Eq. \ref{eq:bolton_solution} is computationally expensive since the matrix $\Psi$ requires a PSF model for every wavelength bin.
    \item Eq. \ref{eq:bolton_solution} is a deconvolution algorithm, meaning it yields a solution that exceeds the physical resolution of the instrument. This introduces severe ringing to the resultant spectrum. \citet{Bolton2009} found a solution that involves ``reconvolving'' the spectrum back to the expected resolution, but this relies on taking the matrix square root of $\bm{\Psi}^T \bm{N}^{-1} \bm{\Psi}$ which is even more computationally expensive than the initial deconvolution.
\end{enumerate}
In the following sections, I detail my efforts to solve each of these problems and how I expect to yield results for my thesis.

\subsection{Point Spread Function Modeling}
\label{subsec:psf}

The first step in constructing a spectro-perfectionism algorithm is determining the PSF of the instrument. Typically, the PSF of an instrument might be constant across the entire CCD, allowing simplification of the deconvolution. However, the PSF of EXPRES changes significantly between orders and even slightly along a single order. For example, the bluest orders on the detector are about 2 pixels taller than the reddest orders.

Thus, a parameterized PSF modal is necessary to map out the PSF pixel-by-pixel. The input to the spectrograph is a rectangular fiber, therefore it makes sense to use a rectangular top hat function as the PSF. However, due to the nature of free space optical paths through chromatic optics, this top hat would be smoothed before it hits the CCD. Therefore, I chose to construct a PSF model that is the convolution of of this tophat and a 2D gaussian function. This combination actually has an analytic solution
\begin{multline}
    \Psi(x, y; A, \theta_x, \theta_y, d_x, d_y, \sigma_x, \sigma_y) = \\
    \frac{1}{4} \Bigg[\Phi\bigg(\frac{x' + d_x/2}{\sigma_x \sqrt{2}}\bigg) - \Phi\bigg(\frac{x' - d_x/2}{\sigma_x \sqrt{2}}\bigg)\Bigg] \Bigg[\Phi\bigg(\frac{y' + d_y/2}{\sigma_y \sqrt{2}}\bigg) - \Phi\bigg(\frac{y' - d_y/2}{\sigma_y \sqrt{2}}\bigg)\Bigg]
    \label{eq:expres_psf}
\end{multline}
where $\Phi(x)$ is the error function, and $x',y'$ are related to $x,y$ by a linear transformation as
\begin{equation}
    \begin{bmatrix}x' \\ y' \end{bmatrix} = 
    \begin{bmatrix}\cos \theta_x & -\sin\theta_x \\ \sin \theta_y & \cos\theta_y\end{bmatrix}\begin{bmatrix}x \\ y\end{bmatrix}.
\end{equation}

This parameterization is advantageous because it is aptly descriptive of the intuited EXPRES PSF:
\begin{itemize}
    \item $d_x$ and $d_y$ are the dimensions of the unsmoothed rectangular tophat function,
    \item $\sigma_x$ and $\sigma_y$ correlate with the amount of smoothing the in x- and y-directions respectively, and
    \item $\theta_x$ and $\theta_y$ correspond to the angles the vertical and horizontal edges of the rectangle make with respect to the CCD pixels.
\end{itemize}
Not only does this model allow us to map the PSF across the CCD with only eight parameters (and a variable amplitude), it also provides information on the magnification and de-focusing of the instrument. Also, since we expect these parameters to vary smoothly across the detector, we can more easily interpolate (and possibly extrapolate) to regions without easily measureable PSFs.

This brings me to the question: how can we actually measure the PSF of EXPRES and produce a parameterization map? I have found two viable options: (1) the Th-Ar lamp already integrated with EXPRES, and (2) an AlN microcomb that has a sufficiently wide FSR. These options are optimal because they are sparse emission line light sources, therefore providing sharply peaked lines over the entire bandwidth of the instrument. We would not be able to use the Menlo LFC, because the lines are much too close together. The resolution of EXPRES (in terms of frequency) is about \SI{3}{\giga\hertz} while the lines of the LFC are spaced at about \SI{14}{\giga\hertz}. Thus, the tails of each LFC line iteract with each neighboring line, removing the ability to precisely measure the PSF of each line.

There is already a great deal of data taken by EXPRES that can be used to measure the pixel-dependent PSF. Th-Ar images are taken during every night of observation and these spectra easily cover the entire bandwidth of EXPRES. Also, the Yale Nanodevices lab provided me with an $\sim$\SI{800}{\giga\hertz} FSR AlN microcomb to use with EXPRES. An image of the microcomb setup at the Discovery Channel Telescope is shown in figure \ref{fig:aln_setup}. This device uses SHG and THG similarly to that described in section \ref{sec:astrocomb}, but it does not require an external IR comb since it produces one intrinsically through whispering gallery resonances in an AlN microring (see the inset of Figure \ref{fig:aln_setup}). I was able to take over 300 images with 6 different microcomb devices at multiple pump laser wavelengths. Although individual images may only cover a about 1/3 to 1/2 of the EXPRES bandpass, by changing the devices and pump laser wavelength, the complete set of data covers most of the CCD.

\begin{figure}
    \centering
    \includegraphics[width=0.5\textwidth]{images/aln_setup.png}
    \caption{The microcomb setup at the Discovery Channel Telescope. In inset is a top-down image of the AlN microring while it is resonating.}
    \label{fig:aln_setup}
\end{figure}

Unfortunately, neither of these light sources are perfect for this application. Th-Ar emission lines frequently come in doublets making individual lines difficult to extract. Also, some regions of the of the spectrum are so dense that they appear as a continuum, skewing the PSF results. The microcomb also occasionally produces ``doublet''-like structure caused by a Raman comb---a phenomenon where light created by Raman scattering weakly resonates in the microring---that happens to be just offset from the primary laser comb. Also, the pump laser is only locked to about \SI{1}{\pico\meter}, which could cause some blurring of each line by less than 0.5 pixels along each order.

Using the data from these images, I have constructed a PSF modelling software package. This package uses an automatic peak-finding algorithm to locate as many lines as it can across the entire image. It then fits the PSF model from Eq. \ref{eq:expres_psf} to each line and records the calculated parameters. As shown in Figure \ref{fig:psf_comparison}, the residuals of the model fit are very small and seemingly random. This code is also able to plot these parameters in terms of $x$ and $y$, as shown for both a Th-Ar emission spectrum and a microcomb spectrum in Figure \ref{fig:psf_params}.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/psf_comparison.png}
    \caption{Comparison between a microcomb line and the fit psf model from Eq. \ref{eq:expres_psf}. The thumbnail for each line is scaled such that the total sum of counts is 1.}
    \label{fig:psf_comparison}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{images/psf_params.png}
    \caption{Preliminary PSF parameter maps in $x$ and $y$ for both the Th-Ar and microcomb sources. The images these data were taken on the same day, thereby they assume the same spectrograph configuration.}
    \label{fig:psf_params}
\end{figure}

I expect to continue using this code to create an entire 2D pixel map for each PSF parameter. I will take the parameterization results from a large set of data and fit a 2D low-order polynomial in $x$ and $y$ to each parameter. I can then use these polynomials to construct a PSF for any pixel position on the EXPRES detector, even in those locations that are not covered by Th-Ar or a microcomb. I can then use this information to better construct an EXPRES spectro-perfectionism algorithm.

\subsection{Improving the spectro-perfectionism algorithm}
\label{subsec:sp_tests}

As explained in Section \ref{subsec:spec_perf_intro}, the specto-perfectionism algorithm is actually a form of deconvolution. Thus, I have looked into ways of optimizing deconvolution for use with a 2D echelle spectrum. For example, it should utilize the fact that the PSF of the instrument is so small (approximately $4 \times 16$ pixels) compared to the size of the CCD array ($10k \times 10k$ pixels) and that the PSF is slowly varying across the CCD. Therefore, an entire $10k \times 10k$ calculated PSF should not necessary for every deconvolved pixel.

The most attractive method so far is gold iterative deconvolution \citep{Morhac2003}. Notice that any inverse matrix can be expanded as
\begin{equation}
    \mathbf{C}^{-1} = (\mathbbm{1}-(\mathbbm{1}-\mathbf{C}))^{-1} \sim \mathbbm{1} + (\mathbbm{1}-\mathbf{C}) + (\mathbbm{1}-\mathbf{C})^2 + (\mathbbm{1}-\mathbf{C})^3 + ...
    \label{eq:inverse_expansion}
\end{equation}
Thus, to solution to the matrix equation $\mathbf{y} = \mathbf{C} \mathbf{x}$ can be written iteratively:
\begin{equation}
    \mathbf{x}^{(k+1)} = \mathbf{y} + (\mathbbm{1} - \mathbf{C}) \mathbf{x}^{(k)}.
\end{equation}
From this, we can derive the Van Cittert deconvolution algorithm \citep{Xu1994}
\begin{equation}
    \mathbf{x}^{(k+1)} = \mathbf{x}&{(k)} + \mu(\mathbf{y} - \mathbf{C}\mathbf{x})
    \label{eq:van_cittert}
\end{equation}
where $\mu$ is a relaxation factor that allows for faster convergence.

Gold deconvolution is simply a modified Eq. \ref{eq:van_cittert} \citep{Morhac2003}. We start by altering the original problem $\mathbf{y}=\mathbf{C}\mathbf{x}$ to instead read
\begin{equation}
    \mathbf{C}^T\mathbf{C}\mathbf{C}^T\mathbf{y} = \mathbf{C}^T\mathbf{C}\mathbf{C}^T\mathbf{C}\mathbf{x}
\end{equation}
thereby ensuring positive definiteness of $\mathbf{x}$, given a positive definite $\mathbf{y}$. We also select a relaxation factor
\begin{equation}
    \mu = \frac{\mathbf{x}^{(k)}}{\mathbf{C}^T\mathbf{C}\mathbf{C}^T\mathbf{C}\mathbf{x}^{(k)}}
    \label{eq:relaxation}
\end{equation}
that maximizes convergence of the system. Plugging these into Van Cittert's algorithm we get
\begin{equation}
    \mathbf{x}^{(k+1)} = \mathbf{x}^{(k)} \frac{\mathbf{C}^T\mathbf{C}\mathbf{C}^T\mathbf{y}}{\mathbf{C}^T\mathbf{C}\mathbf{C}^T\mathbf{C}\mathbf{x}^{(k)}}
    \label{eq:gold_deconv}
\end{equation}
which is the basic form of Gold deconvolution. Setting these matrices to those used in section \ref{subsec:spec_perf_intro} ($\mathbf{y} \rightarrow \mathbf{D}, \mathbf{C} \rightarrow \mathbf{\Psi}, \mathbf{x} \rightarrow \mathbf{s}$), we can use this algorithm to deconvolve echelle spectra.

This algorithm is helpful because it can be optimized for the situation when the PSF is significantly smaller than the full image \citep{Morhac2003}. If $\mathbf{\Psi}_{x,y,\gamma}$ is saved as individual thumbnail images (rather than a complete $10k \times 10k \times N$ array) and we treat each matrix operation in Eq. \ref{eq:gold_deconv} as a convolution rather than a matrix multiplication, both the memory and time requirements for calculation significantly decrease. This is a significant boon for the spectro-perfectionism algorithm, as EXPRES has a lot of data to extract.

Unfortunately, Gold deconvolution itself does not escape the issue of exceeding the instrument resolution. This algorithm will still converge to a solution that has significant ringing. However, there is a clever solution devised by \citet{Magain1998}. Rather than deconvolve the 2D spectrum with the total PSF $\Psi(x)$, choose a narrower PSF $\psi(x)$ such that the deconvolved image remains with it's own properly sampled PSF $p(x)$. These two new functions can be chosen such that their convolution is the original PSF:
\begin{equation}
    \Psi(x) = \psi(x) * p(x).
\end{equation}

If we choose $p(x)$ to be Gaussian, then applying it to our PSF model (Eq. \ref{eq:expres_psf}) is trivial. Since the convolution of two Gaussians is another Gaussian whose variance ($\sigma^2$) is the sum of the initial two variances, we would only need to change $\sigma_x$ and $\sigma_y$ in the model.

I have already introduced a simplified version of spectro-perfectionism to an EXPRES extraction pipeline. Although it has not been thoroughly tested, some preliminary results can be seen in Figure \ref{fig:sp_test} where I compare this algorithm against a naive optimal extraction. In interest of speed, the deconvolution PSF used for this test was uniform across the detector. Spectro-perfectionism appears to have significantly increased S/N in the LFC spectrum (especially by reducing the background coninuum closer to zero). Similarly, the absorption lines in the stellar spectrum appear to be deeper while the blackbody continuum does not have excessive ringing.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/sp_test.png}
    \caption{Preliminary results of a partial EXPRES spectral order extracted using a simplified version of spectro-perfectionism. The horizontal axis is simply pixels and the vertical axis is arbitrary counts. The blue lines are spectra extraction with spectro-perfectionism while the orange lines are the same spectra extracted using a naive form of optimal extraction.}
    \label{fig:sp_test}
\end{figure}

It is important to note here that, as far as I can tell, spectro-perfectionism has not yet been utilized for RV spectroscopy. Thus, I would like to address two outstanding questions through my thesis:
\begin{enumerate}
    \item Can a pixel-dependent PSF be used to ``perfectly'' extract a 2D echelle spectrum in a reasonable amount of computation time?
    \item Does a spectrum extracted using spectro-perfectionism improve upon RV results?
\end{enumerate}
In order to help answer these questions, my future work on the topic of spectro-perfectionism will include continued development of my PSF modelling software to generate a parameterization map that can be applied to an optimized Gold deconvolution algorithm. I would then like to use this spectro-perfectionism extraction on well-known stellar RV targets (such as 51 Peg) and compare the residual scatter of the planet signals against those measured using optimal extraction.

\section{Discussion and Proposed Timeline}

Wavelength calibration for RV spectroscopy is an extremely diverse field. Besides being a physics thesis, the work in this prospectus has applications to astronomy, photonics, signal processing, and much else. There is obviously a lot of content in this prospectus, however I have confidence that I can graduate before the end of 2020. As a summary for this document, my accomplishments so far towards the completion of my thesis are as follows:
\begin{itemize}
    \item I conducted an entire experiment about mitigating optical fiber modal noise and published a paper in the Astrophysical Journal on my findings.
    \item I designed, built, and tested an optimal fiber agitator for use with EXPRES.
    \item I developed PSF modelling software that can automatically calculate PSF parameters for emission lines across the entire EXPRES detector.
    \item I developed a simple spectro-perfectionism extraction algorithm and have received promising preliminary results using EXPRES data.
    \item I built and programmed a piezo alignment stage for easy fiber coupling into AlN waveguides.
    \item I successfully used an AlN microcomb to collect PSF data for EXPRES.
    \item I designed and ordered parts for the prototype EOM comb.
\end{itemize}
The remaining steps I foresee towards the completion of my thesis are thus
\begin{itemize}
    \item I will conduct an experiment that measures the effect of agitation on EXPRES calibration data (1 months) and potentially publish a note on the results.
    \item I will further develop my PSF modelling and spectro-perfectionism software to eventually compare it against optimal extraction using known stellar RV targets and publish a paper on my findings (6 months).
    \item I will construct an unlocked prototype EOM+AlN astrocomb and test it on EXPRES (1 year) with a resultant paper. With any remaining time I happen to find, I may attempt to lock this comb through self-referencing and compare it directly against the Menlo LFC.
\end{itemize}

If all goes well, my contributions to the field of spectroscopic wavelength calibration could make significant waves. Modal noise has long been an issue plaguing spectrograph optical designers, and the simple fix of including quasi-chaotic optical fiber agitation could become standard on the next-generation of RV instruments. The introduction of optimal extraction to the processing pipelines of echelle spectrographs significantly increased the S/N of RV measurement; therefore, I could see spectro-perfectionism playing an equally pivotal role in the coming decade. Finally, the combination of aluminum nitride with existing astrocomb technologies could pave the way towards smaller footprint precision wavelength calibration devices, potentially influencing the designs that take RV spectroscopy into space. I sincerely hope my thesis helps make at least some of this possible.

\pagebreak

\bibliographystyle{aasjournal}
\bibliography{thesis_prospectus}

\end{document}